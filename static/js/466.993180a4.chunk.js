"use strict";(self.webpackChunksocial_network=self.webpackChunksocial_network||[]).push([[466],{8466:function(e,n,t){t.r(n),t.d(n,{default:function(){return oe}});var r=t(2791),s=t(6015),o=t(9911),a=t(7886),i={"messages-received":[],"status-changed":[]},u=null,c=function e(){setTimeout((function(){var n,t;null===(n=u)||void 0===n||n.addEventListener("close",e),null===(t=u)||void 0===t||t.close(),(u=new WebSocket("wss://social-network.samuraijs.com/handlers/ChatHandler.ashx")).addEventListener("close",e)}),3e3)},l=function(e){var n=JSON.parse(e.data);i["messages-received"].forEach((function(e){return e(n)}))},f=function(e){i["status-changed"].forEach((function(n){return n(e)}))},d=function(){f(a.B.READY)},v=function(){f(a.B.ERROR),console.log("REFRESH PAGE")},m=function(){var e,n,t,r;null===(e=u)||void 0===e||e.removeEventListener("close",c),null===(n=u)||void 0===n||n.removeEventListener("message",l),null===(t=u)||void 0===t||t.removeEventListener("open",d),null===(r=u)||void 0===r||r.removeEventListener("error",v)};var h=function(){!function(){var e;m(),null===(e=u)||void 0===e||e.close(),u=new WebSocket("wss://social-network.samuraijs.com/handlers/ChatHandler.ashx"),f(a.B.PENDING),u.addEventListener("close",c),u.addEventListener("message",l),u.addEventListener("open",d),u.addEventListener("error",v)}()},g=function(){var e;i["messages-received"]=[],i["status-changed"]=[],m(),null===(e=u)||void 0===e||e.close()},x=function(e,n){return i[e].push(n),function(){i[e]=i[e].filter((function(e){return e!==n}))}},E=function(e,n){i[e]=i[e].filter((function(e){return e!==n}))},p=function(e){var n;null===(n=u)||void 0===n||n.send(e)},Z=t(1902),j=null,S=function(e){return null===j&&(j=function(n){e(function(e){return{type:Z._.MESSAGES_RECEIVED,payload:{messages:e}}}(n))}),j},w=null,I=function(e){return null===w&&(w=function(n){e(function(e){return{type:Z._.STATUS_CHANGED,payload:{status:e}}}(n))}),w},k=function(){return function(e){E("messages-received",S(e)),E("status-changed",I(e)),g(),e({type:Z._.CLEAR_MESSAGES})}},R=t(885),L=t(8928),y=t(550),C=t(7205),A=t(9434),b=function(e){return e.chat.messages},N=function(e){return e.chat.status},T=t(184),M=function(){var e=(0,o.T)(),n=(0,A.v9)(N),t=(0,r.useState)(""),s=(0,R.Z)(t,2),i=s[0],u=s[1],c=function(){var n,t=i.trim();""!==t&&(e((n=t,function(){p(n)})),u(""))};return(0,T.jsxs)(L.Z,{sx:{margin:1,display:"flex"},children:[(0,T.jsx)(y.Z,{placeholder:"Message...",multiline:!0,rows:4,value:i,onChange:function(e){u(e.currentTarget.value)},onKeyPress:function(e){"Enter"!==e.key||e.shiftKey||(c(),e.preventDefault())},fullWidth:!0}),(0,T.jsx)(C.Z,{variant:"contained",onClick:c,disabled:n!==a.B.READY,children:"Send"})]})},_=t(4565),B=t(1872),D=function(){return(0,T.jsxs)(s.Z,{children:[(0,T.jsx)(_.Z,{variant:"h5",component:"div",sx:{display:"flex",justifyContent:"center",marginBottom:"16px"},children:"Developers Chat"}),(0,T.jsx)(B.Z,{})]})},P=t(5629),H=t(6132),F=t(3366),G=t(7462),O=t(8182),W=t(4419),Y=t(8826),K=t(6863),V=t(5873),J=t(1217);function U(e){return(0,J.Z)("MuiListItemAvatar",e)}(0,t(5878).Z)("MuiListItemAvatar",["root","alignItemsFlexStart"]);var q=["className"],z=(0,K.ZP)("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:function(e,n){var t=e.ownerState;return[n.root,"flex-start"===t.alignItems&&n.alignItemsFlexStart]}})((function(e){var n=e.ownerState;return(0,G.Z)({minWidth:56,flexShrink:0},"flex-start"===n.alignItems&&{marginTop:8})})),Q=r.forwardRef((function(e,n){var t=(0,V.Z)({props:e,name:"MuiListItemAvatar"}),s=t.className,o=(0,F.Z)(t,q),a=r.useContext(Y.Z),i=(0,G.Z)({},t,{alignItems:a.alignItems}),u=function(e){var n=e.alignItems,t=e.classes,r={root:["root","flex-start"===n&&"alignItemsFlexStart"]};return(0,W.Z)(r,U,t)}(i);return(0,T.jsx)(z,(0,G.Z)({className:(0,O.Z)(u.root,s),ownerState:i,ref:n},o))})),X=t(3423),$=t(4346),ee=t(7689),ne=t(9130),te=(0,r.memo)((function(e){var n=e.message,t=(0,ee.s0)();return(0,T.jsxs)(H.ZP,{alignItems:"flex-start",children:[(0,T.jsx)(Q,{children:(0,T.jsx)(X.Z,{alt:n.userName,src:n.photo,onClick:function(){t("".concat(ne.E.PROFILE,"/").concat(n.userId))},style:{cursor:"pointer"}})}),(0,T.jsx)($.Z,{primary:n.userName,secondary:n.message,style:{wordBreak:"break-word"}})]})})),re=function(){var e=(0,A.v9)(b),n=(0,r.useRef)(null),t=(0,r.useState)(!0),s=(0,R.Z)(t,2),o=s[0],a=s[1];return(0,r.useEffect)((function(){var e;o&&(null===(e=n.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[e]),(0,T.jsxs)(P.Z,{sx:{width:"100%",bgcolor:"background.paper",height:"400px",overflowY:"auto"},onScroll:function(e){var n=e.currentTarget;Math.abs(n.scrollHeight-n.scrollTop-n.clientHeight)<300?o||a(!0):o&&a(!1)},children:[e.map((function(e){return(0,T.jsx)(te,{message:e},e.id)})),(0,T.jsx)("div",{ref:n})]})},se=function(){var e=(0,A.v9)(N);return(0,T.jsxs)(L.Z,{sx:{margin:1,padding:{sm:2}},children:[(0,T.jsx)(D,{}),e===a.B.ERROR?(0,T.jsx)("div",{children:"Some error occurred. Please refresh the page"}):(0,T.jsx)(re,{})]})},oe=function(){var e=(0,o.T)();return(0,r.useEffect)((function(){return e((function(e){h(),x("messages-received",S(e)),x("status-changed",I(e))})),function(){e(k())}}),[]),(0,T.jsxs)(s.Z,{sx:{height:"70vh"},children:[(0,T.jsx)(se,{}),(0,T.jsx)(M,{})]})}}}]);
//# sourceMappingURL=466.993180a4.chunk.js.map